# ODI交易信息提取系统

从PDF公告文件中自动提取境外投资交易信息，生成Excel表格的Python自动化工具。

## 功能特点

1. **智能识别境外投资交易**
   - 自动识别标的公司注册地在境外的投资交易
   - 排除境内交易、出口贸易、药品注册等非投资行为
   - 支持多种交易类型：收购股权、设立子公司、境外放款等

2. **全面信息提取**
   - 基本信息文件名称、公告日期、境内公告主体、标的公司名称、注册地、业务范围、交易金额、交易类型、股权比例、交易对手方、进展阶段）
   - 交易结构（投资主体、SPV结构、资金来源、支付方式、对赌承诺、交易架构）
   - 合规审批（境内/境外审批事项、审批进度、审批条件、交割条件、特殊许可）
   - 风险点（预留LLM分析接口）

3. **灵活的Excel输出**
   - 单一Sheet：包含所有信息的完整表格
   - 多Sheet分类：按基本信息、交易结构、合规审批、风险点分类展示
   - 排除文件记录：记录被排除的文件及原因
   - 统计摘要：交易数量、类型分布、国家地区分布等

## 安装步骤

### 1. 环境要求
- Python 3.8+
- pip

### 2. 安装依赖
```bash
cd odi-extractor
pip install -r requirements.txt
```

### 3. 文件结构
```
odi-extractor/
├── odi_extractor.py          # 主程序
├── pdf_parser.py             # PDF解析模块
├── rule_extractor.py         # 规则提取模块
├── odi_classifier.py         # 境外投资识别分类器
├── excel_exporter.py         # Excel导出模块
├── config.py                 # 配置文件
├── utils.py                  # 工具函数
├── requirements.txt          # 依赖包
└── README.md                 # 使用说明（本文件）
```

## 使用方法

### 基本使用

#### 方式1：使用命令行
```bash
# 使用默认配置（pdf_files目录）
python odi_extractor.py

# 指定PDF文件目录
python odi_extractor.py -d /path/to/pdf/files

# 指定输出目录
python odi_extractor.py -o /path/to/output

# 显示详细日志
python odi_extractor.py -v
```

#### 方式2：作为Python模块使用
```python
from odi_extractor import ODIExtractor

# 创建提取器
extractor = ODIExtractor(
    pdf_dir="./pdf_files",
    output_dir="./output"
)

# 运行提取
result = extractor.run()

# 查看结果
print(f"境外投资交易数: {result['odi_count']}")
print(f"输出文件: {result['excel_path']}")
```

### 准备PDF文件

1. 将PDF文件放入指定目录（默认为 `./pdf_files`）
2. 文件命名格式建议：`股票代码 公司名称 日期 标题.pdf`
   - 示例：`000513 丽珠集团 2025-05-23 关于拟收购越南IMP公司股权的公告.pdf`
3. 支持子目录结构

### 配置文件

编辑 `config.py` 可以调整：
- 境外国家/地区关键词库
- 排除标准关键词
- 交易类型关键词
- 审批事项关键词
- 输出文件名等

## 输出说明

### Excel文件结构

生成的Excel文件包含以下Sheet：

| Sheet名称 | 说明 |
|---------|------|
| 全部交易 | 包含所有境外投资交易的完整信息 |
| 基本信息 | 交易的基本信息（公司、标的公司、金额等） |
| 交易结构 | 交易的结构信息（投资主体、SPV、资金来源等） |
| 合规审批 | 审批相关事项和进度 |
| 风险点 | 风险分析（预留接口，待扩展LLM分析） |
| 排除文件 | 被排除的文件列表及原因 |
| 统计摘要 | 交易数量、类型、国家地区分布统计 |

### 字段说明

#### 基本信息
- 文件名称：PDF文件名
- 公告日期：公告发布日期
- 境内公告主体：上市公司名称及代码
- 标的公司/项目名称：目标公司或项目名称
- 标的公司注册地：标的公司注册国家/地区
- 业务范围：标的公司主营业务
- 交易金额/投资额：交易金额或投资总额
- 交易类型：收购股权、设立子公司、境外放款等
- 股权比例：收购或持有的股权比例
- 交易对手方：交易对方名称
- 当前进展阶段：拟收购、已交割、审批中等

#### 交易结构
- 投资主体：实际进行投资的境内主体
- SPV结构：是否通过SPV/中间层公司投资
- 资金来源：自有资金、银行贷款、发债等
- 支付方式：现金、股权置换、分期支付等
- 对赌/业绩承诺：是否有对赌协议或业绩承诺
- 交易架构：文本描述的交易结构路径

#### 合规审批
- 境内审批事项：发改委、商务部、外汇局等审批
- 境外审批事项：反垄断审查、外商投资审批等
- 审批进度：各项审批的当前进度
- 审批条件：审批所需的先决条件
- 交割条件：交易完成所需满足的条件
- 特殊许可：是否需要特殊行业许可

## 境外投资识别规则

### 纳入标准
满足以下任一条件即纳入：
- 标的公司注册地在境外
- 设立境外子公司/合资公司
- 收购境外公司股权
- 向境外公司放款/借款
- 取得境外牌照（需有投资行为）

### 排除标准
满足以下任一条件即排除：
- 纯境内交易（收购境内公司股权、境内项目担保等）
- 出口贸易业务
- 仅仅取得境外监管注册/批准（如药品上市注册）
- 境外上市
- 运营数据披露、财务数据披露等纯信息披露
- 仅为境外子公司提供担保（无新项目投资）

## 技术架构

```
┌─────────────────┐
│  扫描PDF文件    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  文件名解析     │  提取股票代码、公司名、公告日期
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  PDF内容提取    │  提取文本内容
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  境外投资识别   │  规则匹配：判断是否为境外投资
└────────┬────────┘
         │
    ┌────┴────┐
    │         │
    ▼         ▼
  是         否
    │         │
    ▼         ▼
┌─────────────┐  ┌─────────────┐
│  规则提取   │  │  标记排除   │
└──────┬──────┘  └─────────────┘
       │
       ▼
┌─────────────────┐
│  数据整合       │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Excel导出      │
└─────────────────┘
```

## 性能参考

处理速度：约1-2秒/个PDF文件

示例：
- 30个PDF文件：约30-60秒
- 500个PDF文件：约8-17分钟

## 注意事项

1. **PDF格式要求**
   - 支持文本型PDF
   - 扫描版PDF需要先进行OCR处理
   - 加密PDF需要先解密

2. **文件命名**
   - 建议使用标准命名格式以便准确解析
   - 如果文件名不规范，信息提取可能不准确

3. **信息准确性**
   - 规则提取基于关键词和正则匹配，可能存在误差
   - 建议人工核对重要字段
   - 可以通过调整config.py中的规则来提高准确性

4. **系统资源**
   - 处理大量PDF时会占用较多内存
   - 建议分批处理500+文件

## 常见问题

### Q: 为什么某些境外投资没有被识别？
A: 检查以下几点：
1. 文件中是否包含境外国家/地区名称
2. 是否包含投资相关关键词（投资、收购、并购等）
3. 是否触发了排除规则

### Q: 为什么某些境内交易被错误识别为境外投资？
A: 可能的原因：
1. 文件名或标题中包含国家名称（如"中国"）
2. 可以调整config.py中的排除规则

### Q: 可以处理哪些格式的PDF？
A: 支持标准文本型PDF。扫描版PDF需要先进行OCR处理。

### Q: 如何提高提取准确性？
A:
1. 优化PDF文件命名格式
2. 调整config.py中的关键词规则
3. 对于复杂文件，建议人工核对

## 后续扩展

- Web界面：开发简单Web界面，支持上传PDF并在线查看结果
- 数据库存储：将提取结果存入数据库，支持查询和统计分析
- LLM风险分析：集成LLM进行智能风险分析
- OCR支持：支持扫描版PDF的OCR识别
- 多语言支持：支持英文PDF文件处理

## 技术支持

如有问题或建议，请联系开发者。

## 许可证

本工具仅供学习和研究使用。
