"""
配置文件 - 跨境交易PDF信息提取系统
"""

import os

# ========== 文件路径配置 ==========
# 获取test目录（ODI项目的根目录）
BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))

# PDF文件目录
PDF_DIR = os.path.join(BASE_DIR, "odi-extractor", "pdf_files")

# 如果不存在，尝试test目录
if not os.path.exists(PDF_DIR):
    PDF_DIR = BASE_DIR

# 输出目录
OUTPUT_DIR = os.path.join(BASE_DIR, "odi-extractor", "output")

# 日志目录
LOG_DIR = os.path.join(BASE_DIR, "odi-extractor", "logs")

# Excel输出文件名
EXCEL_FILE = "ODI交易信息汇总.xlsx"

# ========== 境外国家/地区关键词 ==========
COUNTRIES = {
    "亚洲": [
        "香港", "澳门", "台湾", "越南", "新加坡", "日本", "韩国",
        "泰国", "马来西亚", "印度尼西亚", "菲律宾", "文莱", "柬埔寨",
        "老挝", "缅甸", "印度", "巴基斯坦", "孟加拉国", "斯里兰卡",
        "尼泊尔", "马尔代夫", "伊朗", "伊拉克", "沙特阿拉伯",
        "阿联酋", "卡塔尔", "科威特", "巴林", "阿曼", "约旦",
        "黎巴嫩", "以色列", "叙利亚", "也门", "土耳其", "哈萨克斯坦"
    ],
    "欧洲": [
        "英国", "法国", "德国", "意大利", "西班牙", "葡萄牙", "荷兰",
        "比利时", "卢森堡", "奥地利", "瑞士", "瑞典", "挪威", "丹麦",
        "芬兰", "波兰", "捷克", "匈牙利", "罗马尼亚", "保加利亚",
        "希腊", "爱尔兰", "爱沙尼亚", "拉脱维亚", "立陶宛", "俄罗斯", "白俄罗斯"
    ],
    "美洲": [
        "美国", "加拿大", "墨西哥", "巴西", "阿根廷", "智利", "秘鲁",
        "哥伦比亚", "委内瑞拉", "厄瓜多尔", "玻利维亚", "巴拉圭",
        "乌拉圭", "哥斯达黎加", "巴拿马", "古巴", "多米尼加",
        "牙买加", "海地", "波多黎各"
    ],
    "非洲": [
        "埃及", "利比亚", "突尼斯", "阿尔及利亚", "摩洛哥", "埃塞俄比亚",
        "肯尼亚", "坦桑尼亚", "乌干达", "卢旺达", "布隆迪", "刚果",
        "赞比亚", "津巴布韦", "莫桑比克", "安哥拉", "纳米比亚",
        "博茨瓦纳", "南非", "尼日利亚", "加纳", "科特迪瓦", "塞内加尔"
    ],
    "大洋洲": [
        "澳大利亚", "新西兰", "斐济", "巴布亚新几内亚"
    ]
}

# 扁平化的国家关键词列表（用于快速匹配）
COUNTRIES_FLAT = [country for region in COUNTRIES.values() for country in region]

# ========== 排除关键词 ==========
EXCLUDE_KEYWORDS = [
    "出口贸易", "出口产品", "出口业务",
    "境外生产药品", "境外药品", "境外注册",
    "境外上市", "海外上市",
    "运营数据", "运营情况", "财务数据", "经营数据", "主要运营数据",
    "自愿性信息披露", "自愿性公告",
    "仅取得", "仅获得", "仅申请"
]

# 纯境内交易关键词
DOMESTIC_KEYWORDS = [
    "中国境内", "中国大陆", "境内收购", "国内收购",
    "上海", "北京", "广州", "深圳", "青岛", "天津",
    "浙江", "江苏", "广东", "福建", "山东", "四川", "湖北"
]

# ========== 交易类型关键词 ==========
TRANSACTION_TYPES = {
    "收购股权": ["收购", "并购", "股份购买", "股权收购", "受让股权", "股权投资"],
    "设立子公司": ["设立", "成立", "投资", "建设", "新建", "投资设立"],
    "境外放款": ["放款", "借款", "融资", "委托贷款", "资金拆借"],
    "取得牌照": ["取得", "获得", "申请"],
    "增资": ["增资", "追加投资"]
}

# ========== 审批事项关键词 ==========
APPROVAL_KEYWORDS = {
    "发改委": ["国家发展和改革委员会", "发改委", "国家发改委", "境外投资项目备案"],
    "商务部": ["商务部", "对外投资", "企业境外投资"],
    "外汇局": ["国家外汇管理局", "外汇局", "外汇管理"],
    "反垄断审查": ["反垄断审查", "经营者集中", "竞争审查"],
    "行业审批": ["行业主管部门", "监管部门", "特殊许可", "资质"]
}

# ========== 风险关键词 ==========
RISK_KEYWORDS = {
    "法律风险": ["诉讼", "仲裁", "争议", "纠纷", "合同条款", "管辖权"],
    "政策风险": ["政策变化", "政治风险", "制裁", "监管", "政策调整"],
    "财务风险": ["汇率", "资金", "流动性", "财务", "利率"],
    "经营风险": ["市场", "管理", "运营", "竞争", "经营"],
    "尽调问题": ["历史", "纠纷", "诉讼", "处罚", "违规"]
}

# ========== LLM配置（可选） ==========
USE_LLM = False  # 是否使用LLM进行风险分析
LLM_API_KEY = ""  # API密钥
LLM_MODEL = "claude-sonnet-4-20250514"  # 模型名称
LLM_MAX_TOKENS = 4000  # 最大token数

# ========== Zhipu GLM-4 LLM配置 ==========
USE_LLM_EXTRACTION = True  # 是否使用LLM进行信息提取（True=LLM优先，False=仅规则提取）

# Zhipu AI API配置
ZHIPU_API_KEY = "0c635d21b2874a7cbcdde585befb2a41.oE1aFnjAUENDIDjR"  # 格式: "id.secret"，从 https://open.bigmodel.cn/ 获取
ZHIPU_BASE_URL = "https://open.bigmodel.cn/api/paas/v4/"
ZHIPU_MODEL = "glm-4"  # 可选: "glm-4", "glm-4-flash"
ZHIPU_MAX_TOKENS = 4000  # 最大返回token数
ZHIPU_TEMPERATURE = 0.1  # 低温度以获得更稳定的结构化输出
ZHIPU_TIMEOUT = 30  # API请求超时时间（秒）

# LLM提取策略
LLM_EXTRACTION_STRATEGY = "hybrid"  # "llm_only" | "rule_only" | "hybrid"

# Fallback策略
ENABLE_RULE_FALLBACK = True  # LLM失败时是否回退到规则提取
LLM_RETRY_ATTEMPTS = 2  # LLM失败重试次数
LLM_RETRY_DELAY = 1.0  # 重试延迟（秒）

# 性能优化
ENABLE_LLM_CACHING = True  # 启用响应缓存
CACHE_DIR = os.path.join(os.path.dirname(__file__), "../llm_cache")
REQUEST_RATE_LIMIT = 2  # 每秒最多请求数

# 提示词配置
SYSTEM_PROMPT_TEMPLATE = """你是专业的境外投资交易信息提取专家。请从给定的PDF公告文本中提取结构化的交易信息。

工作原则：
1. 准确性优先：确保提取的信息准确反映公告内容
2. 完整性：提取公告中明确提及的所有相关信息
3. 格式规范：严格按照要求的JSON格式返回结果
4. 空值处理：如果文本中没有明确提及某个字段，返回空字符串

特别注意：
- "当前进展阶段"应提取状态描述（如"已通过审议"、"已完成交割"），不要提取百分比
- "标的公司/项目名称"应提取完整的外文名称，不要只提取描述性简称
- 金额和比例要保留原文格式和单位
返回的JSON必须是可以直接解析的标准格式，不要包含任何说明文字。"""

# ========== 其他配置 ==========
# 日期格式
DATE_FORMATS = ["%Y-%m-%d", "%Y年%m月%d日"]

# 支持的PDF文件扩展名
PDF_EXTENSIONS = [".pdf", ".PDF"]

# 日志级别
LOG_LEVEL = "INFO"
